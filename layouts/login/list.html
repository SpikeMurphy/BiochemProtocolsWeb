{{/* layouts/login/list.html */}}
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ .Title }}</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; padding: 2rem; max-width: 520px; margin: auto; }
    h1 { margin-bottom: .5rem; }
    input { padding: .6rem; width: 100%; box-sizing: border-box; margin-top: .5rem; }
    button { padding: .7rem; width: 100%; margin-top: .8rem; }
    .msg { margin-top: .75rem; color: #b00020; }
    .hint { color: #555; font-size: .9rem; margin-top: .5rem; }
  </style>
</head>
<body>
  <h1>Zugangscode eingeben</h1>
  <p class="hint">Gib den Code ein, den du erhalten hast. Der Zugriff bleibt für 30 Tage auf diesem Gerät.</p>

  <input id="codeInput" type="text" placeholder="Zugangscode" autocomplete="off" />
  <button id="checkBtn">Freischalten</button>
  <p id="message" class="msg" role="status" aria-live="polite"></p>

  <script>
  // === Passwortliste wird hier inline vom Hugo-Template injiziert ===
  const validCodes = {{ .Site.Data.access.passwords | jsonify }};
  // ===============================================================

  // Hilfsfunktionen für Cookie
  function setCookie(name, value, days) {
    const expires = new Date();
    expires.setDate(expires.getDate() + days);
    document.cookie = name + "=" + encodeURIComponent(value) + "; path=/; expires=" + expires.toUTCString() + "; SameSite=Lax";
  }

  function getCookie(name) {
    const m = document.cookie.split("; ").find(c => c.startsWith(name + "="));
    return m ? decodeURIComponent(m.split("=")[1]) : null;
  }

  document.getElementById("checkBtn").addEventListener("click", tryCode);
  document.getElementById("codeInput").addEventListener("keydown", (e) => { if (e.key === "Enter") tryCode(); });

  function tryCode() {
    const code = document.getElementById("codeInput").value.trim();
    const msgEl = document.getElementById("message");
    msgEl.textContent = "";

    if (!code) {
      msgEl.textContent = "Bitte einen Code eingeben.";
      return;
    }

    // einfache, case-sensitive Prüfung (kannst du anpassen)
    if (validCodes.includes(code)) {
      setCookie("access_ok", "true", 30); // 30 Tage
      msgEl.style.color = "green";
      msgEl.textContent = "Code akzeptiert — Du wirst weitergeleitet…";

      // komme zurück zur ursprünglich angeforderten Seite (falls gesetzt)
      const target = localStorage.getItem("requested_path") || "/";
      localStorage.removeItem("requested_path");
      // leichte Verzögerung, damit der User das Feedback sieht
      setTimeout(() => { window.location.href = target; }, 350);
    } else {
      msgEl.style.color = "#b00020";
      msgEl.textContent = "Code ungültig. Bitte erneut versuchen.";
    }
  }

  // Optional: Wenn ein ?code=XYZ in der URL übergeben wurde, automatisch prüfen
  (function autoCheckFromURL() {
    const params = new URLSearchParams(window.location.search);
    const urlCode = params.get("code");
    if (urlCode) {
      document.getElementById("codeInput").value = urlCode;
      tryCode();
    }
  })();
  </script>
</body>
</html>
